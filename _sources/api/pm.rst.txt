pm
==

电源管理

pm.request(mode)
----------------

请求进入指定的休眠模式

参数
~~~~

========== ===================================
传入值类型 解释
========== ===================================
int        休眠模式,例如pm.IDLE/LIGHT/DEEP/HIB
========== ===================================

返回值
~~~~~~

========== ===================================
返回值类型 解释
========== ===================================
int        休眠模式,例如pm.IDLE/LIGHT/DEEP/HIB
========== ===================================

.. _返回值-1:

返回值
~~~~~~

.. code:: lua

   -- 请求进入休眠模式
   pm.request(pm.HIB)

--------------

pm.dtimerStart(id, timeout)
---------------------------

启动底层定时器,在休眠模式下依然生效. 只触发一次

.. _参数-1:

参数
~~~~

========== ==================
传入值类型 解释
========== ==================
int        定时器id,通常是0-3
int        定时时长,单位毫秒
========== ==================

.. _返回值-2:

返回值
~~~~~~

========== ==================
返回值类型 解释
========== ==================
int        定时器id,通常是0-3
int        定时时长,单位毫秒
========== ==================

.. _返回值-3:

返回值
~~~~~~

.. code:: lua

   -- 添加底层定时器
   pm.dtimerStart(0, 300 * 1000) -- 5分钟后唤醒

--------------

pm.dtimerStop(id)
-----------------

关闭底层定时器

.. _参数-2:

参数
~~~~

========== ========
传入值类型 解释
========== ========
int        定时器id
========== ========

.. _返回值-4:

返回值
~~~~~~

无

.. _返回值-5:

返回值
~~~~~~

.. code:: lua

   -- 关闭底层定时器
   pm.dtimerStop(0) -- 关闭id=0的底层定时器

--------------

pm.dtimerCheck(id)
------------------

检查底层定时器是不是在运行

.. _参数-3:

参数
~~~~

========== ========
传入值类型 解释
========== ========
int        定时器id
========== ========

.. _返回值-6:

返回值
~~~~~~

========== ========
返回值类型 解释
========== ========
int        定时器id
========== ========

.. _返回值-7:

返回值
~~~~~~

.. code:: lua

   -- 检查底层定时器是不是在运行
   pm.dtimerCheck(0) -- 检查id=0的底层定时器

--------------

pm.lastReson()
--------------

开机原因,用于判断是从休眠模块开机,还是电源/复位开机

.. _参数-4:

参数
~~~~

无

.. _返回值-8:

返回值
~~~~~~

========== ====
返回值类型 解释
========== ====
========== ====

.. _返回值-9:

返回值
~~~~~~

.. code:: lua

   -- 是哪种方式开机呢
   log.info("pm", "last power reson", pm.lastReson)

--------------

pm.force(mode)
--------------

强制进入指定的休眠模式

.. _参数-5:

参数
~~~~

========== ======================
传入值类型 解释
========== ======================
int        休眠模式,仅pm.DEEP/HIB
========== ======================

.. _返回值-10:

返回值
~~~~~~

========== ======================
返回值类型 解释
========== ======================
int        休眠模式,仅pm.DEEP/HIB
========== ======================

.. _返回值-11:

返回值
~~~~~~

.. code:: lua

   -- 请求进入休眠模式
   pm.force(pm.HIB)

--------------

pm.check()
----------

检查休眠状态

.. _参数-6:

参数
~~~~

无

.. _返回值-12:

返回值
~~~~~~

========== ====
返回值类型 解释
========== ====
========== ====

.. _返回值-13:

返回值
~~~~~~

.. code:: lua

   -- 请求进入休眠模式,然后检查是否能真的休眠
   pm.request(pm.HIB)
   if pm.check() then
       log.info("pm", "it is ok to hib")
   else
       pm.force(pm.HIB) -- 强制休眠
   end

--------------
