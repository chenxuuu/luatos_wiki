socket
======

socket操作库

socket.ntpSync(server)
----------------------

ntp时间同步

参数
~~~~

========== ===================================
传入值类型 解释
========== ===================================
string     ntp服务器域名,默认值ntp1.aliyun.com
========== ===================================

返回值
~~~~~~

========== ===================================
返回值类型 解释
========== ===================================
string     ntp服务器域名,默认值ntp1.aliyun.com
========== ===================================

.. _返回值-1:

返回值
~~~~~~

.. code:: lua

   socket.ntpSync()
   sys.subscribe("NTP_UPDATE", function(re)
       log.info("ntp", "result", re)
   end)

--------------

socket.tsend(host, port, data)
------------------------------

直接向地址发送一段数据

.. _参数-1:

参数
~~~~

========== ================
传入值类型 解释
========== ================
string     服务器域名或者ip
int        服务器端口号
string     待发送的数据
========== ================

.. _返回值-2:

返回值
~~~~~~

========== ================
返回值类型 解释
========== ================
string     服务器域名或者ip
int        服务器端口号
string     待发送的数据
========== ================

.. _返回值-3:

返回值
~~~~~~

.. code:: lua

   socket.tsend("www.baidu.com", 80, "GET / HTTP/1.0\r\n\r\n")

--------------

socket.isReady()
----------------

网络是否就绪

.. _参数-2:

参数
~~~~

无

.. _返回值-4:

返回值
~~~~~~

========== ====
返回值类型 解释
========== ====
========== ====

.. _返回值-5:

返回值
~~~~~~

.. code:: lua

   无

--------------

socket.ip()
-----------

获取自身ip,通常是内网ip

.. _参数-3:

参数
~~~~

无

.. _返回值-6:

返回值
~~~~~~

========== ====
返回值类型 解释
========== ====
========== ====

.. _返回值-7:

返回值
~~~~~~

.. code:: lua

   无

--------------

socket.tcp()
------------

新建一个tcp socket

.. _参数-4:

参数
~~~~

无

.. _返回值-8:

返回值
~~~~~~

========== ====
返回值类型 解释
========== ====
========== ====

.. _返回值-9:

返回值
~~~~~~

.. code:: lua

   --  如果读取失败,会返回nil
   local so = socket.tcp()
   if so then
       so:host("www.baidu.com")
       so:port(80)
       so:on("connect", function(id, re)
           if re == 1 then
               so:send("GET / HTTP/1.0\r\n\r\n")
           end
       end)
       so:on("recv", function(id, data)
           log.info("netc", id, data)
       end)
       if so:start() == 1 then
           sys.waitUntil("NETC_END_" .. so:id())
       end
       so:close()
       so:clean()
   end

--------------

socket.udp()
------------

新建一个udp socket

.. _参数-5:

参数
~~~~

无

.. _返回值-10:

返回值
~~~~~~

========== ====
返回值类型 解释
========== ====
========== ====

.. _返回值-11:

返回值
~~~~~~

.. code:: lua

   无

--------------

so:start(host, port)
--------------------

启动socket线程

.. _参数-6:

参数
~~~~

+------------+--------------------------------------------------------+
| 传入值类型 | 解释                                                   |
+============+========================================================+
| string     | 服务器域名                                             |
|            | 或ip,如果已经使用so:host和so:port配置,就不需要传参数了 |
+------------+--------------------------------------------------------+
| port       | 服务器                                                 |
|            | 端口,如果已经使用so:host和so:port配置,就不需要传参数了 |
+------------+--------------------------------------------------------+

.. _返回值-12:

返回值
~~~~~~

+------------+--------------------------------------------------------+
| 返回值类型 | 解释                                                   |
+============+========================================================+
| string     | 服务器域名                                             |
|            | 或ip,如果已经使用so:host和so:port配置,就不需要传参数了 |
+------------+--------------------------------------------------------+
| port       | 服务器                                                 |
|            | 端口,如果已经使用so:host和so:port配置,就不需要传参数了 |
+------------+--------------------------------------------------------+

.. _返回值-13:

返回值
~~~~~~

.. code:: lua

   -- 参考socket.tcp的说明, 并查阅demo

--------------

so:close()
----------

关闭socket对象

.. _参数-7:

参数
~~~~

无

.. _返回值-14:

返回值
~~~~~~

========== ====
返回值类型 解释
========== ====
========== ====

.. _返回值-15:

返回值
~~~~~~

.. code:: lua

   -- 参考socket.tcp的说明, 并查阅demo

--------------

so:send(data,flags)
-------------------

通过socket对象发送数据

.. _参数-8:

参数
~~~~

+------------+--------------------------------------------------------+
| 传入值类型 | 解释                                                   |
+============+========================================================+
| string     | 待发送数据                                             |
+------------+--------------------------------------------------------+
| int        | 可选的额外参数,底层相关.例如NBIOT下的rai值,            |
|            | 传入2,代表数据已经全部发送完成,可更快进入休眠.         |
+------------+--------------------------------------------------------+

.. _返回值-16:

返回值
~~~~~~

+------------+--------------------------------------------------------+
| 返回值类型 | 解释                                                   |
+============+========================================================+
| string     | 待发送数据                                             |
+------------+--------------------------------------------------------+
| int        | 可选的额外参数,底层相关.例如NBIOT下的rai值,            |
|            | 传入2,代表数据已经全部发送完成,可更快进入休眠.         |
+------------+--------------------------------------------------------+

.. _返回值-17:

返回值
~~~~~~

.. code:: lua

   -- 参考socket.tcp的说明, 并查阅demo

--------------

so:id()
-------

获取socket对象的id

.. _参数-9:

参数
~~~~

无

.. _返回值-18:

返回值
~~~~~~

========== ====
返回值类型 解释
========== ====
========== ====

.. _返回值-19:

返回值
~~~~~~

.. code:: lua

   无

--------------

so:host(host)
-------------

设置服务器域名或ip

.. _参数-10:

参数
~~~~

========== ==============
传入值类型 解释
========== ==============
string     服务器域名或ip
========== ==============

.. _返回值-20:

返回值
~~~~~~

========== ==============
返回值类型 解释
========== ==============
string     服务器域名或ip
========== ==============

.. _返回值-21:

返回值
~~~~~~

.. code:: lua

   -- 参考socket.tcp的说明, 并查阅demo

--------------

so:port(port)
-------------

设置服务器端口

.. _参数-11:

参数
~~~~

========== ==========
传入值类型 解释
========== ==========
int        服务器端口
========== ==========

.. _返回值-22:

返回值
~~~~~~

========== ==========
返回值类型 解释
========== ==========
int        服务器端口
========== ==========

.. _返回值-23:

返回值
~~~~~~

.. code:: lua

   -- 参考socket.tcp的说明, 并查阅demo

--------------

so:clean(0)
-----------

清理socket关联的资源,socket对象在废弃前必须调用

.. _参数-12:

参数
~~~~

无

.. _返回值-24:

返回值
~~~~~~

========== ====
返回值类型 解释
========== ====
========== ====

.. _返回值-25:

返回值
~~~~~~

.. code:: lua

   -- 参考socket.tcp的说明, 并查阅demo

--------------

so:port(event, func)
--------------------

设置socket的事件回调

.. _参数-13:

参数
~~~~

========== ========
传入值类型 解释
========== ========
string     事件名称
function   回调方法
========== ========

.. _返回值-26:

返回值
~~~~~~

========== ========
返回值类型 解释
========== ========
string     事件名称
function   回调方法
========== ========

.. _返回值-27:

返回值
~~~~~~

.. code:: lua

   -- 参考socket.tcp的说明, 并查阅demo

--------------

so:closed()
-----------

socket是否已经断开?

.. _参数-14:

参数
~~~~

无

.. _返回值-28:

返回值
~~~~~~

========== ====
返回值类型 解释
========== ====
========== ====

.. _返回值-29:

返回值
~~~~~~

.. code:: lua

   -- 参考socket.tcp的说明, 并查阅demo

--------------

so:rebind(socket_id)
--------------------

为netclient绑定socket id, 该操作仅在NBIOT模块下有意义.

.. _参数-15:

参数
~~~~

========== ===========
传入值类型 解释
========== ===========
int        socket的id.
========== ===========

.. _返回值-30:

返回值
~~~~~~

========== ===========
返回值类型 解释
========== ===========
int        socket的id.
========== ===========

.. _返回值-31:

返回值
~~~~~~

.. code:: lua

   -- 参考socket.tcp的说明, 并查阅demo

--------------

so:sockid()
-----------

获取底层socket id

.. _参数-16:

参数
~~~~

无

.. _返回值-32:

返回值
~~~~~~

========== ====
返回值类型 解释
========== ====
========== ====

.. _返回值-33:

返回值
~~~~~~

.. code:: lua

   -- 参考socket.tcp的说明, 并查阅demo

--------------
